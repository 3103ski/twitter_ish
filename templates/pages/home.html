{% extends 'base.html' %}

<!-- Header Title -->
{% block head_title %} Something Twitterish {% endblock head_title%}

<!-- Body Content -->
{% block content %}
<h1>Welcome to something Twitterish</h1>

<div id="tweets">
	Loading...
</div>

<script>
	const tweetElement = document.getElementById('tweets');

	const xhr = new XMLHttpRequest();
	const method = 'GET';
	const url = '/tweets';
	const responseType = 'json';

	handleDidLike = (tweet_id, currCount) => {
		console.log(tweet_id, +' ' + currCount);
	};

	likeBtn = (tweet) => {
		return `<button class='btn btn-primary' onClick=handleDidLike(${tweet.id},${tweet.likes})>${tweet.likes} Likes</button>`;
	};

	formatTweetElement = (tweet) => {
		var formattedTweet = `
	           <div class="mb-4 tweet" id="tweet-${tweet.id}">
	               <p>${tweet.content}</p>
	               <div class='btn-group'>
	                   ${likeBtn(tweet)}
	               </div>
	           </div>
	       `;
		return formattedTweet;
	};

	xhr.responseType = responseType;
	xhr.open(method, url);
	xhr.onload = () => {
		const serverResponse = xhr.response;
		var listedItems = serverResponse.response;
		var finalTweetStr = '';
		var i;
		for (i = 0; i < 3; i++) {
			const el = listedItems[i];
			finalTweetStr += formatTweetElement(el);
		}
		tweetElement.innerHTML = finalTweetStr;
	};
	xhr.send();
</script>

{% endblock content %}
